<!-- Source: https://github.com/youtube/youtube-ios-player-helper/blob/ff5991e6e3188867fe2738aa92913a37127f8f1d/youtube-ios-player-helper/Assets.bundle/Assets/YTPlayerView-iframe-player.html -->
<!DOCTYPE html>
<html>

<head>
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            margin: 0;
            width: 100%;
            height: 100%;
        }

        html {
            width: 100%;
            height: 100%;
        }

        .embed-container iframe,
        .embed-container object,
        .embed-container embed {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
        }
        ::-webkit-scrollbar {
            display: none !important;
        }
    </style>
</head>

<body>
    <!-- YouTube Player iFrame Container -->
    <div class="embed-container">
        <div id="player"></div>
    </div>
    <!-- YouTube iFrame JS API -->
    <script src="https://www.youtube.com/iframe_api"
        onerror="window.location.href='youtubeplayer://onIframeAPIFailedToLoad">
    </script>
    <!-- Custom JS -->
    <script>
        // The YouTube Player instance
        var player;

        // Configure YouTube Player
        window.YT.ready(() => {
            // Initialize YouTube Player
            // The second parameter will be replaced during runtime
            player = new window.YT.Player(
                'player',
                %@
            );
            // Set initial size
            player.setSize(
                window.innerWidth,
                window.innerHeight
            );
            // Send onIframeAPIReady event
            sendYouTubePlayerEvent('onIframeAPIReady');
        });
        
        // function retrieveVideoTagElement() {
        //     try {
        //         video = innerDocument.getElementsByClassName('html5-main-video')[0];
        //         video.crossOrigin = "anonymous";
        //         alert("Succeeded to retrieve video");
        //     } catch(error) {
        //         alert("Failed to retrieve video");
        //     }
        // }
        
        function takeScreenshot() {
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            var screenshot = document.createElement('screenshot');
            // var video = document.querySelector('video');
            
            try {
                var captureStream = await navigator.mediaDevices.getDisplayMedia();
                screenshot.srcObject = captureStream;
                context.drawImage(screenshot, 0, 0, window.width, window.height);
                var data = canvas.toDataURL('image/jpeg');
                captureStream.getTracks().forEach(track => track.stop());
                return data;
            } catch (err) {
                return err;
            }
            
           // video = document.getElementById('player');
           //  // var innerDocument = qPlayer.contentWindow.document;
           //  //video = innerDocument.querySelector('video');//getElementsByClassName('html5-main-video')[0];
           //  // video.crossOrigin = "anonymous";
           //  
           //  // Change the size here
           //  canvas.width = parseInt(video.width);
           //  canvas.height = parseInt(video.height);
           //  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
           //  
           //  // Won't work on file:/// URLs. SecurityError: Tainted canvases may not be exported.
           //  var base64ImageData = canvas.toDataURL('image/jpeg');
           //  return base64ImageData;
            // try{
            //     if(video.tagName == 'VIDEO') {
            //         var canvas = document.createElement("canvas");
            //         canvas.width = video.videoWidth;
            //         canvas.height = video.videoHeight;
            //         canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            //         var data = canvas.toDataURL("image/jpeg", 0.9).split(';base64,')[1];
            //         alert("Succeeded to take screenshot");
            //         return data;
            //     }
            // } catch(error) {
            //     alert("Failed to take screenshot");
            //     return null;
            // }
        }

        // Set YouTubePlayer Size
        function setYouTubePlayerSize(width, height) {
            // Check if YouTubePlayer is available
            if (player) {
                // Set Player size
                player.setSize(
                    width,
                    height
                );
            }
        }

        // Send YouTubePlayer Event with optional data
        function sendYouTubePlayerEvent(event, data) {
            var locationHref = 'youtubeplayer://' + event;
            if (data) {
                locationHref = locationHref + '?data=' + data;
            }
            window.location.href = locationHref
        }

        // YouTube Player onReady event callback
        function onReady(event) {
            // Send onReady event
            sendYouTubePlayerEvent('onReady');
        }

        // YouTube Player onStateChange event callback
        function onStateChange(event) {
            // Send onStateChange event
            sendYouTubePlayerEvent('onStateChange', event.data);
        }

        // YouTube Player onPlaybackQualityChange event callback
        function onPlaybackQualityChange(event) {
            // Send onPlaybackQualityChange event
            sendYouTubePlayerEvent('onPlaybackQualityChange', event.data);
        }

        // YouTube Player onPlaybackRateChange event callback
        function onPlaybackRateChange(event) {
            // Send onPlaybackRateChange event
            sendYouTubePlayerEvent('onPlaybackRateChange', event.data);
        }

        // YouTube Player onError event callback
        function onError(event) {
            // Send onError error
            sendYouTubePlayerEvent('onError', event.data);
        }
    </script>
</body>

</html>
